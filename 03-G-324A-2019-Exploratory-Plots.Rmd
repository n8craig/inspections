# Reading and Preliminary Graphing of Inspection Data

This document is a preliminary proof of concept and initial exploratory data analysis [@tukey1977]. Goals of the document are to:

-   illustrate the kinds of analysis possible with the tabulation of ICE inspection data
-   provide preliminary exploratory plot of select variables from the Significant Incident Summary Sheets.
-   generate some preliminary summary information

The data are presently incomplete and represent results compiled as of `r Sys.Date()`.

```{r setup-3, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE
)
```

```{r load-libraries-3}
# Load necessary libraries

# Reading and wrangling
library(googlesheets4)
library(readr)
library(tidyverse)
library(janitor)
library(lubridate)
library(DT)

# Plotting
library(ggplot2)
library(RColorBrewer)

# Tables
library(kableExtra)

# Load custom function
source("function_clean_facility_names.R", local = knitr::knit_global())
```

## Method for Reading G-324A-19-inc form

The code for this report is specific to data logged in the G-324A-19 form and the incident summaries portion of that form. The incident summary portion of this form is probably the most complex data structure in the project and also contains the largest volume of quantitative information. Therefore, it seemed like a good place to start with an initial proof of concept.

At the outset, there were issues reading in the Google Sheet. Several of the numeric columns read into R as lists which was undesirable. In the Google Sheet, Craig set the columns to `plain text` rather than `auto` and the data are read into R as character columns. This seemed to resolve the issue for a time, and it was possible to use the `type_convert()` function from the `readr` library [@R-readr] to convert these columns to numbers. The `col_types` argument of the `read_sheet` function of the `googlesheets4` library [@R-googlesheets4] was used to explicitly set the column types to character. After applying the `clean_facility_names` custom function, additional transformations like converting facility to a factor are applied.

There were some issues using `lubridate` [@R-lubridate] to wrangle the month and year fields to a proper date. Craig was not able to discern the cause of the issue. However, changing the month format on the incident sheet from abbreviated to fully written out months solved the issue. Those changes were made in the master Google Sheet and the data were called using the `googlesheets4` library.

```{r read-data-324-3, echo=TRUE}
# Read in Sheet G-324A-19
df_324 <- read_sheet("https://docs.google.com/spreadsheets/d/1im5VSi3bIEi13O8WQ56wEIXSyNEstbGMylXXgD9bAG0/edit#gid=1858227071",
                 sheet="G-324A-19",
                 col_names = TRUE,
                 col_types = "c") %>% 
  clean_names() %>% 
  
  # Run custom cleaning function
  clean_facility_names() %>% 
  
  # df specific changes
  mutate(facility = as.factor(facility),
         state = as.factor(state),
         date = mdy(inspection_date),
         current_inspection_date_from = mdy(current_inspection_date_from),
         current_inspection_date_to = mdy(current_inspection_date_to)
         ) %>% 
  relocate(date, .before = inspection_date) %>% 
  mutate_at(c(20:49), as.numeric)
```

```{r read-data-324-incident-3, echo=TRUE}
# Read Google Sheet incident worksheet, convert to data frame, and wrangle
df_324_inc <- read_sheet("https://docs.google.com/spreadsheets/d/1im5VSi3bIEi13O8WQ56wEIXSyNEstbGMylXXgD9bAG0/edit#gid=1858227071",
                 sheet="G-324A-19-inc",
                 col_types = "c") %>% 
  clean_names() %>%
  
  # Run custom cleaning function
  clean_facility_names() %>% 


  # df_specific changes
  unite(date, year:month) %>% 
  mutate(facility = as.factor(facility),
         state = as.factor(state),
         date = ym(date)
         ) %>% 
  mutate_at(c(6:76), as.numeric)
```

At present `r nrow(df_324)` SIS and inspection cover letter combinations out of approximately 300 inspections are complete. The completed inspections range in time from `r min(df_324$date, na.rm = TRUE)` to `r max(df_324$date, na.rm = TRUE)`. Students are now working on older SIS forms which are structured differently. The preliminary EDA in this document is restricted to the more current SIS forms which were first used in May 2019.

## SIS Form structure

The ICE G-324A Significant Incident Summary contains information on the following categories of information:

-   Assaults
-   Disciplinary
-   Solitary
-   Use of Force
-   Sexual Abuse and Assault
-   Medical
-   Cause of Death

As a preliminary step of analysis, each of these categories is explored with a summary table and facet plot in order to look at larger trends.

## Summary Tables

Summary tables help to provide an overview of how many instances occur within particular category of data or how frequent a particular issue is recorded at a given facility. Summary tables are generated using a combination of `group_by` with `summarize` with the results piped to `kable` and `kableExtra`. This produces results similar to a "pivot table" from Excel.

Table \@ref(tab:inspection-count) shows the number of inspections per facility that are processed so far. The values range from 1-3 inspections. Dorchester County Detention Center, Golden State Annex, and River Correctional Center all have three inspections.

```{r inspection-count}
df_facility <- df_324 %>% 
  group_by(facility) %>% 
  summarise(n_inspections = n()) %>% 
  ungroup() 
  
df_facility %>% 
  kable(caption = "Inspections Reviewed by Facility",
        col.names = c("Facility", "Inspections Reviewed")) %>% 
  kable_styling(c("hover", "striped", "condensed", "responsive")) %>% 
  scroll_box(height = "300px")
```

## Facet Plots

Facet plots partition each portion of a plot into a matrix of panels. These plots are produced for several categories of data where each panel represents a facility for a given variable reported in the SIS form. Within each category, columns are pivoted longer and plotted by date. Graphing is done using the `ggplot2` library [@R-ggplot2] with the `facet_wrap` function to provide a means to compare multiple facilities simultaneously. Such a plot can help identify trends and guide more specific questions.

```{r package-references-3, echo=FALSE}
knitr::write_bib(file = 'packages.bib')
```
