<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Nathan Craig" />


<title>Data Cleaning</title>

<script src="site_libs/header-attrs-2.8/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>




<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">ICE Inspection Review</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fas fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="02-Data-Cleaning.html">Clean Data</a>
</li>
<li>
  <a href="03-G-324A-2019-Exploratory-Plots.html">Preliminary Plots</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/n8craig/inspections">
    <span class="fa fa fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Data Cleaning</h1>
<h4 class="author">Nathan Craig</h4>
<h4 class="date">Tuesday July 06, 2021</h4>

</div>


<div id="introduction" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>Anyone familiar working with ICE data knows that the agency is notorious for releasing dirty data filled with pesky errors. For example, consider the Krome Service Processing Center, the very first immigration processing center established in the 1980’s after the closure of Ellis Island in 1954. Of all the facilities the agency should name consistently, Krome the very first detention center of the contemporary system, one would expect ICE to get right. However, the facility inspections page lists the following names for the Krome Service Processing Center:</p>
<ul>
<li>Krome Special Processing Center (SPC) (FL) - Feb. 10, 2021</li>
<li>Krome Service Procesing Center (FL) - Feb. 13, 2020</li>
<li>Krome SPC (FL) - Feb. 14, 2019</li>
</ul>
<p>Every instance is different. In one case “Special” is replaced for “Service.” In another case the word processing is misspelled “Procesing,” while in a third, the title is abbreviated. This is one example of many. In other cases facilities are sometimes named “Detention Center” rather than “Detention Facility,” etc. Assembling the data into a useful table that can be sorted, filtered, and summarized requires standardizing the names.</p>
<p>From early on, Craig decided to assemble the data as reported, errors and all, and perform standardization programmatically. Doing this facilitates reproducibility. The project’s primary cleaning functions are incorporated into a custom function <code>clean_facility_names()</code> and moved to a <a href="https://github.com/n8craig/inspections/blob/main/function_clean_facility_names.R">separate R file</a>. This allows more than 100 lines of code to be collapsed into a single function call. However, for display purposes, the lines of code that make up the transformations are detailed on this page.</p>
<pre class="r"><code># Load necessary libraries
library(googlesheets4)
library(readr)
library(tidyverse)
library(janitor)
library(lubridate)</code></pre>
</div>
<div id="cleaning-script" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Cleaning Script</h1>
<p>During the time that the students were assembling data, we worked out of a Google Sheet as this permitted each of us to have simultaneous access to the data. For preliminary analysis, a data frame is constructed by reading from the sheet.</p>
<pre class="r"><code># Read in the sheet
df_inspect &lt;- read_sheet(&quot;https://docs.google.com/spreadsheets/d/1im5VSi3bIEi13O8WQ56wEIXSyNEstbGMylXXgD9bAG0/edit#gid=1858227071&quot;,
                 sheet=&quot;Inspections&quot;,
                 col_names = TRUE,
                 col_types = &quot;c&quot;) %&gt;% 
  clean_names()</code></pre>
<p>Sometimes facility names are repeated. Use of the <code>dplyr</code> function <code>distinct</code> is useful for isolating issues with field names <span class="citation">[@R-dplyr]</span>.</p>
<pre class="r"><code>df_inspect %&gt;% 
  distinct(facility, .keep_all = TRUE) %&gt;% 
  arrange(facility)</code></pre>
<pre><code>## # A tibble: 374 x 11
##    id    facility     cr     file_name_4   dr     file_name_6  status entered_by
##    &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;  &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt;  &lt;chr&gt;     
##  1 25    Adams Count~ Cover~ adamsCoCorrC~ Deten~ adamsCoCorr~ Finis~ NMC       
##  2 141   Adams Count~ Cover~ adamsCoMS_SI~ Deten~ adamsCoMS_C~ Finis~ NMC       
##  3 290   Adelanto IC~ Cover~ adelantoEast~ Deten~ adelantoEas~ Finis~ NMC       
##  4 291   Adelanto IC~ Cover~ adelantoWest~ Deten~ adelantoWes~ Start~ ATR       
##  5 43    Adelanto IC~ Cover~ adelantoEast~ Deten~ adelantoEas~ Finis~ NMC       
##  6 142   Adelanto IC~ Cover~ adelantoEast~ Deten~ adelantoEas~ Finis~ NMC       
##  7 44    Adelanto IC~ Cover~ adelantoWest~ Deten~ adelantoWes~ Finis~ ATR       
##  8 143   Adelanto IC~ Cover~ adelantoWest~ Deten~ adelantoWes~ Finis~ KB        
##  9 12    Alamance Co~ Cover~ alamanceCoJa~ Deten~ alamanceCoJ~ Finis~ ATR       
## 10 144   Alamance Co~ Cover~ alamanceCoNC~ Deten~ No SIS prov~ Finis~ NMC       
## # ... with 364 more rows, and 3 more variables: completed_on &lt;chr&gt;,
## #   needs_review &lt;chr&gt;, note &lt;chr&gt;</code></pre>
<p>The following procedures detail the main facility name cleaning operations. This block of code was converted to a custom function and written to an R file. By doing this, the entire following code block can be called with a single function, or incorporated into an analysis specific pipeline. The cleaning procedures are provided here to show the transformations, but the separate function file can be <a href="https://github.com/n8craig/inspections/blob/main/function_clean_facility_names.R">downloaded</a> directly. Heavy use is made of the <code>dplyr</code> library <span class="citation">[@R-dplyr]</span> <code>mutate</code> function in combination with the <code>stringr</code> library <span class="citation">[@R-stringr]</span> functions <code>str_replace_all</code> and <code>replace</code> functions. All of these are part of the <code>tidyverse</code> <span class="citation">[@R-tidyverse]</span> family of libraries.</p>
<pre class="r"><code>df_inspect &lt;- df_inspect %&gt;% 
  # Removing a curious whitespace character that appears
  # in more recent facility names
  mutate(facility = str_replace_all(facility,
         pattern = &quot; &quot;,
         replacement = &quot; &quot;)) %&gt;% 
  
  separate(.,
           col = facility,
           into = c(&quot;facility&quot;,&quot;inspection_date&quot;),
           sep = &quot;\\) - &quot;) %&gt;%
  separate(.,
           col = facility,
           into = c(&quot;facility&quot;,&quot;state&quot;),
           sep = &quot;\\(&quot;) %&gt;% 

  # Deal with issues in the file names, state, and inspection date
  mutate(facility = str_trim(facility, side = &quot;both&quot;),
         state = str_trim(state, side = &quot;both&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Adelanto ICE Processing Center-East&quot;,
                            replacement = &quot;Adelanto ICE Processing Center - East&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Adelanto ICE Processing Center-West&quot;,
                            replacement = &quot;Adelanto ICE Processing Center - West&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Allen Parish Detention Facility&quot;,
                            replacement = &quot;Allen Parish Public Safety Complex&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Berks County Residential Center&quot;,
                            replacement = &quot;Berks Family Residential Center&quot;),
         inspection_date = replace(inspection_date, inspection_date==&quot;Jan. 29 - 31, 2019&quot;, &quot;Jan. 31, 2019&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Bristol County Jail$&quot;,
                            replacement = &quot;Bristol County Jail and House of Correction&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Buffalo$&quot;,
                            replacement = &quot;Buffalo Batavia Service Processing Center&quot;),
         state = replace(state, state == &quot;Batavia) Service Processing Center&quot;, &quot;NY&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Calhoun County Jail&quot;,
                            replacement = &quot;Calhoun County Correctional Center&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Clay County Justice Center&quot;,
                            replacement = &quot;Clay County Jail&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Coastal Bend Detention Facility&quot;,
                            replacement = &quot;Coastal Bend Detention Center&quot;),
         state = replace(state, state == &quot;David L. Moss Criminal Justice Center)&quot;, &quot;OK&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Dodge County Detention Center&quot;,
                            replacement = &quot;Dodge County Detention Facility&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Donald W. Wyatt Detention Center&quot;,
                            replacement = &quot;Donald W. Wyatt Detention Facility&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Essex County Corrections Facility&quot;,
                            replacement = &quot;Essex County Correctional Facility&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Farmville Detention Center$&quot;,
                            replacement = &quot;Immigration Centers of America - Farmville&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Florence SPC&quot;,
                            replacement = &quot;Florence Service Processing Center&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Houston CDF&quot;,
                            replacement = &quot;Houston Contract Detention Facility&quot;),
         state = replace(state, state == &quot;Polk)&quot;, &quot;TX&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Immigration Centers of America$&quot;,
                            replacement = &quot;Immigration Centers of America - Farmville&quot;),
         state = replace(state, state ==&quot;ICA&quot;, &quot;VA&quot;),
         inspection_date = replace(inspection_date,
                                   inspection_date == &quot;Farmville Detention Center (FDC) (VA&quot;,
                                   &quot;Feb. 24, 2021&quot;),
         # This one picks a value in the facility col and changes a value in the state col
         state = replace(state, facility == &quot;Immigration Centers of America - Farmville&quot;,
                         &quot;VA&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Joe Corley Detention Facility&quot;,
                            replacement = &quot;Joe Corley Processing Center&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Karnes County Residential Center&quot;,
                            replacement = &quot;Karnes County Family Residential Center&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Krome SPC&quot;,
                            replacement = &quot;Krome Service Procesing Center&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Krome Special Processing Center&quot;,
                            replacement = &quot;Krome Service Procesing Center&quot;),
         state = replace(state, state ==&quot;SPC)&quot;, &quot;FL&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Mesa Verde Detention Facility&quot;,
                            replacement = &quot;Mesa Verde ICE Processing Facility&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Northwest Contract Detention Center&quot;,
                            replacement = &quot;Northwest ICE Processing Center&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Northwest Detention Center&quot;,
                            replacement = &quot;Northwest ICE Processing Center&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Okmulgee County Jail-Moore Detention Facility&quot;,
                            replacement = &quot;Okmulgee County Jail - Moore Detention Facility&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Orange County Jail&quot;,
                            replacement = &quot;Orange County Correctional Facility&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Otay Mesa Detention Facility&quot;,
                            replacement = &quot;Otay Mesa Detention Center&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Prarieland Detention Center&quot;,
                            replacement = &quot;Prairieland Detention Center&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Richwood Correcrtional Center&quot;,
                            replacement = &quot;Richwood Correctional Center&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Rio Grande Processing Center&quot;,
                            replacement = &quot;Rio Grande Detention Center&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Robert A. Deyton Correctional Center&quot;,
                            replacement = &quot;Robert A. Deyton Detention Facility&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Robert A. Deyton Detention Center&quot;,
                            replacement = &quot;Robert A. Deyton Detention Facility&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^South Texas Detention Complex&quot;,
                            replacement = &quot;South Texas ICE Processing Center&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^South Texas Processing Center&quot;,
                            replacement = &quot;South Texas ICE Processing Center&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Strafford County Corrections&quot;,
                            replacement = &quot;Strafford County Department of Corrections&quot;),
         inspection_date = replace(inspection_date, state ==&quot;CO)- Mar. 31, 2021&quot;, &quot;Mar. 31, 2021&quot;),
         state = replace(state, state == &quot;CO)- Mar. 31, 2021&quot;, &quot;CO&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^T. Don Hutto Detention Center$&quot;,
                            replacement = &quot;T. Don Hutto Residential Center&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;Tulsa County Jail - David L. Moss Criminal Jutice Center&quot;,
                            replacement = &quot;David L. Moss Criminal Justice Center&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Tulsa County Jail$&quot;,
                            replacement = &quot;David L. Moss Criminal Justice Center&quot;),
         state = replace(state, state == &quot;David L. Moss Justice Center)&quot;, &quot;OK&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Washoe County Detention Centerr&quot;,
                            replacement = &quot;Washoe County Detention Center&quot;),
         facility = str_replace_all(facility,
                            pattern = &quot;^Webb County Detention Facility&quot;,
                            replacement = &quot;Webb County Detention Center&quot;),
         )</code></pre>
</div>
<div id="references" class="section level1" number="3">
<h1><span class="header-section-number">3</span> References</h1>
<div id="refs">

</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
