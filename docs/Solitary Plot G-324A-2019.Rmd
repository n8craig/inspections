---
title: "Preliminary Reading and Graphing of Inspection Data"
author: "Nathan Craig"
date: "`r format(Sys.Date(), '%A %B %d, %Y')`"
output:
  bookdown::html_document2: 
    toc: true
    toc_float: true
    number_sections: true
    df_print: paged
    code_folding: hide
bibliography: packages.bib
---

This document is a preliminary proof of concept to illustrate:

-   the kinds of analysis possible with the tabulation of ICE inspection data
-   code for reading the spreadsheet
-   specific wrangling methods unique to the data structure
-   preliminary exploratory plot of select variables from the Significant Incident Summary Sheets.

The data are incomplete and represent results compiled as of `r Sys.Date()`.

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
```

```{r load-libraries}
# Load necessary libraries
library(googlesheets4)
library(readr)
library(tidyverse)
library(janitor)
library(lubridate)
library(DT)
```

# Method for Reading G-324A-19-inc form

The code in the Appendix is specific to data logged in G-324A-19 incident summaries. However, this is probably the most complex data structure in the project but also the largest volume of quantitative information. Therefore, it seemed like a good place to start with an initial proof of concept.

There were initial issues reading in the Google Sheet. Several of the numeric columns read into R as lists which was undesirable. In the Google Sheet, Craig set the columns to `plain text` rather than `auto` and the data read in fine as character columns. This seemed to resolve the issue, and it was possible to use the `type_convert()` function from the `readr` library [@R-readr] to convert these columns to numbers.

There were also some issues using `lubridate` [@R-lubridate] to wrangle the month and year fields to a proper date. Craig was not able to discern the cause of the issue. However, changing the month format on the incident sheet from abbreviated to fully written out months solved the issue. Those changes were made in the master Google Sheet and the data were called using the `googlesheets4` library [@R-googlesheets4].


```{r read-data-324}
# Read in Sheet G-324A-19
df_324 <- read_sheet("https://docs.google.com/spreadsheets/d/1im5VSi3bIEi13O8WQ56wEIXSyNEstbGMylXXgD9bAG0/edit#gid=1858227071",
                 sheet="G-324A-19") %>% 
  clean_names() %>% 

    # Clean up the facility names separating out inspection date and state
  # Note the use of a double escape character. This was necessary.
  separate(.,
           col = facility,
           into = c("facility","inspection_date"),
           sep = "\\) - ") %>%
  separate(.,
           col = facility,
           into = c("facility","state"),
           sep = "\\(") %>% 

    # Convert the character type cols to numbers
  type_convert() %>% 
  mutate(facility = as.factor(facility),
         state = as.factor(state),
         date = mdy(inspection_date)
         ) %>% 
  relocate(date, .before = inspection_date)
```


```{r read-data-324-incident}
# Read Google Sheet incident worksheet, convert to data frame, and wrangle
df_324_inc <- read_sheet("https://docs.google.com/spreadsheets/d/1im5VSi3bIEi13O8WQ56wEIXSyNEstbGMylXXgD9bAG0/edit#gid=1858227071",
                 sheet="G-324A-19-inc") %>% 
  clean_names() %>% 

    # Clean up the facility names separating out inspection date and state
  # Note the use of a double escape character. This was necessary.
  separate(.,
           col = facility,
           into = c("facility","inspection_date"),
           sep = "\\) - ") %>%
  separate(.,
           col = facility,
           into = c("facility","state"),
           sep = "\\(") %>% 

    # Convert the character type cols to numbers
  type_convert() %>% 
  unite(date, year:month) %>% 
  mutate(facility = as.factor(facility),
         state = as.factor(state),
         date = ym(date)
         )
```


# Assaults

```{r assault-facet, fig.height=35}

# Generating a linetype vector for use in the plot
lines <- c(
    "solid",
    "solid",
    "solid",
    "solid",
    "dotted"
    )

df_324_inc %>%
  
  # Subset the df to only the used cols
  select(id, facility, date,
       detainee_physical_assault_on_staff_with_serious_injury:
       detainee_on_detainee_physical_assault_fight_with_no_serious_injury
       ) %>% 
  
  # Need the rowwise function to compute a row-at-a-time
  # in the following mutate function
  rowwise(id) %>% 
  
  # Create a new total assaults column
  mutate(total_assaults = sum(c_across(
       detainee_physical_assault_on_staff_with_serious_injury:
       detainee_on_detainee_physical_assault_fight_with_no_serious_injury
  ))) %>% 

  # Call a range of table columns and pivot long
  pivot_longer(.,
               cols=  detainee_physical_assault_on_staff_with_serious_injury:total_assaults,
               names_to = "assault_type",
               values_to = "assault_count") %>% 
  
  # Calling the plot and formatting
  ggplot(aes(x=date, y = assault_count, linetype=assault_type))+
  geom_line(aes(color = assault_type)) +
  
  # The line type must be set in the ggplot call
  # then the line type values vector passed to the arg
  scale_linetype_manual(
    values = lines,
    labels = c(
    "Detained Person on Staff w. Serious Injury",
    "Detained Person on Staff w/o Serious Injury",
    "Detained Person on Detained Person w. Serous Injury",
    "Detained Person on Detained Person w/o Serous Injury",
    "Total Assaults"),
    name = "Assault Type:",
    guide = guide_legend(nrow = 5)
    )+
  
  # Setting the color
  scale_color_manual(
  values = c("green",
              "darkgreen",
              "red",
              "darkred",
              "black"),
  
    labels = c(
    "Detained Person on Staff w. Serious Injury",
    "Detained Person on Staff w/o Serious Injury",
    "Detained Person on Detained Person w. Serous Injury",
    "Detained Person on Detained Person w/o Serous Injury",
    "Total Assaults"),
  name = "Assault Type:"
  )+

  labs(title = "Reported Assaults")+
  ylab("Number of Assaults")+
  xlab("Date")+
  theme(
    strip.text = element_text(size = 8),
    legend.position = "bottom"
    )+

    # Set the legend to multiple rows
  guides(col = guide_legend(nrow =5))+
  
  # Wrap
  facet_wrap(~ facility, ncol=3)
```

# Disciplinary

```{r disciplinary-facet, fig.height=35}
# Generating a linetype vector for use in the plot
lines <- c(
    "solid",
    "solid",
    "solid",
    "solid",
    "solid",
    "dotted"
    )

df_324_inc %>%
  
  # Subset the df to only the used cols
  select(id, facility, date,
       disciplinary_infractions:
       sanctions_over_60_days
       ) %>% 
  
  # Need the rowwise function to compute a row-at-a-time
  # in the following mutate function
  rowwise(id) %>% 
  
  # Create a new total assaults column
  mutate(total_disciplinary = sum(c_across(
       disciplinary_infractions:
       sanctions_over_60_days
  ))) %>% 

  # Call a range of table columns and pivot long
  pivot_longer(.,
               cols=  disciplinary_infractions:total_disciplinary,
               names_to = "disciplinary_type",
               values_to = "disciplinary_count") %>%
  
  # Calling the plot and formatting
  ggplot(aes(x=date, y = disciplinary_count, linetype=disciplinary_type))+
  geom_line(aes(color = disciplinary_type)) +
  
  # The line type must be set in the ggplot call
  # then the line type values vector passed to the arg
  scale_linetype_manual(
    values = lines,
    labels = c(
    "Disciplinary Infractions",
    "Disciplinary Infractions - Guilty",
    "Disciplinary Appeals",
    "Disciplinary Appeals in Favor of Detainee",
    "Sanctions Over 60 Days",
    "Total Disciplinary"),
    name = "Disciplinary Type:",
    guide = guide_legend(nrow = 6)
    )+
  
  # Setting the color
  scale_color_manual(
  values = c("green",
              "darkgreen",
              "red",
              "darkred",
              "yellow",
              "black"),
  
    labels = c(
    "Disciplinary Infractions",
    "Disciplinary Infractions - Guilty",
    "Disciplinary Appeals",
    "Disciplinary Appeals in Favor of Detainee",
    "Sanctions Over 60 Days",
    "Total Disciplinary"),
    name = "Disciplinary Type:"
  )+

  labs(title = "Disciplinary")+
  ylab("Number of Disciplinary Infractions")+
  xlab("Date")+
  theme(
    strip.text = element_text(size = 8),
    legend.position = "bottom"
    )+

    # Set the legend to multiple rows
  guides(col = guide_legend(nrow =6))+
  
  # Wrap
  facet_wrap(~ facility, ncol=3)
```

# Solitary

Four columns of solitary type are pivoted longer and plotted by date. Graphing was done using the `ggplot2` library [@R-ggplot2] with the `facet_wrap` function to provide a means to compare multiple facilities simultaneously. Such a plot can help identify trends and guide more specific questions.

```{r solitary-facet, fig.height=35}
# Graph specific wrangling, pivoting several cols longer
df_324_inc %>%
  
  # Call a range of table columns
  pivot_longer(.,
               cols= detainees_placed_in_administrative_segregation:detainees_placed_in_segregation_for_mental_health_reasons,names_to = "segregation_type", values_to = "segregation_count") %>% 
  
  # Select a subset of columns to work with
  select(facility, date, segregation_type, segregation_count) %>% 

# Calling the plot and formatting
  ggplot(aes(x=date, y = segregation_count))+
  geom_line(aes(color = segregation_type)) +
  labs(title = "Reported Use of Solitary")+
  ylab("Number of Individuals Palced in Solitary")+
  xlab("Date")+
  theme(
    strip.text = element_text(size = 8),
    legend.position = "bottom"
    )+
    scale_color_manual(
      values = c("green",
                 "red",
                 "blue",
                 "black"),
      name = "Solitary Type:",
      labels = c(
        "Administrative",
        "Disciplinary",
        "Medical",
        "Mental Health")
      )+
    facet_wrap(~ facility, ncol=3)
```


# Use of Force

```{r use-force-facet, fig.height=35}
# Generating a linetype vector for use in the plot
lines <- c(
    "solid",
    "solid",
    "solid",
    "solid",
    "solid",
    "solid",
    "solid",
    "dotted"
    )

df_324_inc %>%
  
  # Subset the df to only the used cols
  select(id, facility, date,
       immediate_use_of_force_incidents:
       strip_searches
       ) %>% 
  
  # Need the rowwise function to compute a row-at-a-time
  # in the following mutate function
  rowwise(id) %>% 
  
  # Create a new total assaults column
  mutate(total_use_of_force = sum(c_across(
       immediate_use_of_force_incidents:
       strip_searches
  ))) %>% 

  # Call a range of table columns and pivot long
  pivot_longer(.,
               cols=  immediate_use_of_force_incidents:total_use_of_force,
               names_to = "use_of_force_type",
               values_to = "use_of_force_count") %>%
  
  # Calling the plot and formatting
  ggplot(aes(x=date, y = use_of_force_count, linetype=use_of_force_type))+
  geom_line(aes(color = use_of_force_type)) +
  
  # The line type must be set in the ggplot call
  # then the line type values vector passed to the arg
  scale_linetype_manual(
    values = lines,
    labels = c(
    "Immediate Use of Force Incidents",
    "Calculated Use of Force Incidents",
    "Uses of Force with Chemical Agents",
    "Incidents Where Non-Lethal Weapons Were Used",
    "Times 4/5 Point Restraints Used",
    "Use of Force With Serious Injury",
    "Strip Searches",
    "Total Disciplinary"),
    name = "Use of Force Type:",
    guide = guide_legend(nrow = 8)
    )+
  
  # Setting the color
  scale_color_manual(
  values = c("green",
              "darkgreen",
              "red",
              "darkred",
              "yellow",
              "turquoise4",
              "orangered3",
              "black"),
  
    labels = c(
    "Immediate Use of Force Incidents",
    "Calculated Use of Force Incidents",
    "Uses of Force with Chemical Agents",
    "Incidents Where Non-Lethal Weapons Were Used",
    "Times 4/5 Point Restraints Used",
    "Use of Force With Serious Injury",
    "Strip Searches",
    "Total Disciplinary"),
    name = "Use of Force Type:",
  )+

  labs(title = "Disciplinary")+
  ylab("Number of Disciplinary Infractions")+
  xlab("Date")+
  theme(
    strip.text = element_text(size = 8),
    legend.position = "bottom"
    )+

    # Set the legend to multiple rows
  guides(col = guide_legend(nrow =8))+
  
  # Wrap
  facet_wrap(~ facility, ncol=3)
```

# Sexual Abuse and Assault Allegations


```{r sexual-abuse-facet, fig.height=35}
# Generating a linetype vector for use in the plot
lines <- c(
    "solid",
    "solid",
    "solid",
    "solid",
    "solid",
    "dotted"
    )

df_324_inc %>%
  
  # Subset the df to only the used cols
  select(id, facility, date,
       sexual_abuse_allegations_detainee_on_detainee:
       sexual_abuse_allegations_detainee_on_staff_contractor_volunteer_29
       ) %>% 
  
  # Need the rowwise function to compute a row-at-a-time
  # in the following mutate function
  rowwise(id) %>% 
  
  # Create a new total assaults column
  mutate(total_sexual_abuse_allegations = sum(c_across(
       sexual_abuse_allegations_detainee_on_detainee:
       sexual_abuse_allegations_detainee_on_staff_contractor_volunteer_29
  ))) %>% 

  # Call a range of table columns and pivot long
  pivot_longer(.,
               cols=  sexual_abuse_allegations_detainee_on_detainee:total_sexual_abuse_allegations,
               names_to = "sexual_abuse_allegations_type",
               values_to = "sexual_abuse_allegations_count") %>%
  
  
  
  
    # Calling the plot and formatting
  ggplot(aes(x=date, y = sexual_abuse_allegations_count, linetype=sexual_abuse_allegations_type))+
  geom_line(aes(color = sexual_abuse_allegations_type)) +
  
  # The line type must be set in the ggplot call
  # then the line type values vector passed to the arg
  scale_linetype_manual(
    values = lines,
    labels = c(
    "Sexual Abuse Allegations - Detainee on Detainee",
    "Sexual Abuse Allegations - Inmate on Detainee",
    "Sexual Abuse Allegations - Detainee on Inmate",
    "Sexual Abuse Allegations - Staff/Contractor/Volunteer on Detainee",
    "Number of Sexual Abuse Allegations - Detainee on Staff/Contractor/Volunteer",
    "Total Sexual Abuse Allegations"),
    name = "Sexual Abuse Allegation Type:",
    guide = guide_legend(nrow = 6)
    )+
  
  # Setting the color
  scale_color_manual(
  values = c("green",
              "darkgreen",
              "red",
              "darkred",
              "yellow",
              "black"),
    labels = c(
    "Sexual Abuse Allegations - Detainee on Detainee",
    "Sexual Abuse Allegations - Inmate on Detainee",
    "Sexual Abuse Allegations - Detainee on Inmate",
    "Sexual Abuse Allegations - Staff/Contractor/Volunteer on Detainee",
    "Number of Sexual Abuse Allegations - Detainee on Staff/Contractor/Volunteer",
    "Total Sexual Abuse Allegations"),
    name = "Sexual Abuse Allegation Type:",
  )+

  labs(title = "Sexual Abuse Allegations")+
  ylab("Number of Allegations")+
  xlab("Date")+
  theme(
    strip.text = element_text(size = 8),
    legend.position = "bottom"
    )+

    # Set the legend to multiple rows
  guides(col = guide_legend(nrow =8))+
  
  # Wrap
  facet_wrap(~ facility, ncol=3)
```



# Suicide

## Suicide as Cause of Death

Based on the present state of the sample, the following facilities experienced deaths caused by suicides. Note that both ICE and non-ICE deaths by suicide are reported. Note that based on the status of the data as of `r Sys.Date()`, all of the deaths by suicide occurred in facilities run by county sheriff's offices or county prison boards.


```{r suicide-cod-table}
# Select columns for analysis and filter

df_324 %>% 
  select(id,
         facility,
         state,
         date,
         fac_operator,
         cod_suicide_ice,
         cod_suicide_not_ice) %>% 
  drop_na() %>% 
  filter(cod_suicide_ice>0|cod_suicide_not_ice >0) %>% 
  mutate(cod_suicide_total = cod_suicide_ice + cod_suicide_not_ice) %>% 
  datatable()
```

Bar plot of ICE and non-ICE deaths by suicide plotted by facility as of `r Sys.Date()`.

```{r suicide-cod-plot}
df_324 %>% 
  select(id,
         facility,
         state,
         date,
         fac_operator,
         cod_suicide_ice,
         cod_suicide_not_ice) %>% 
  drop_na() %>% 
  filter(cod_suicide_ice>0|cod_suicide_not_ice >0) %>% 
  mutate(cod_suicide_total = cod_suicide_ice + cod_suicide_not_ice) %>% 
  ggplot(aes(x=cod_suicide_total, y=facility))+
  geom_boxplot()+
  scale_x_continuous(breaks = c(1,2))+
  labs(title = "Cause of Death Suicide",
       subtitle = "Includes ICE and non-ICE Suicides")+
  xlab("COD Suicide Total")+
  ylab("Facility")
```

## Facet Plot of Suicide Attempts and Watches

The following shows Suicide Attempts and Suicide Watches based on the status of the data as of `r Sys.Date()`. The numbers are subject to change.

```{r suicide-facet, fig.height=35}
df_324_inc %>%
  
  # Subset the df to only the used cols
  select(id, facility, date,
       suicide_attempts_or_self_harm,
       suicide_watches_constant_watch_mental_health_observation
       ) %>% 
  drop_na() %>% 
 
  # Call a range of table columns and pivot long
  pivot_longer(.,
               cols=  c(suicide_attempts_or_self_harm,
       suicide_watches_constant_watch_mental_health_observation),
               names_to = "suicide_type",
               values_to = "suicide_count") %>% 
  
   filter(suicide_type > 0) %>% 
  

  # Calling the plot and formatting
  ggplot(aes(x=date, y = suicide_count))+
  geom_line(aes(color=suicide_type)) +
  
  scale_color_manual(
    values = c("red",
             "blue"
             ),
    labels = c(
      "Suicide Attempts or Self Harm",
      "Suicide Watches/Constant Watch/Mental Health Observation"
      ),
    name = "Type:"
    )+
  
  labs(title = "Suicide Attempts and Watches")+
  ylab("Number of Attempts or Watches")+
  xlab("Date")+
  theme(
    strip.text = element_text(size = 5),
    legend.position = "bottom"
    )+
    # Set the legend to multiple rows
  guides(col = guide_legend(nrow =5))+
  
  # Wrap
  facet_wrap(~ facility, ncol = 3)


```

# Observations

Observations made on the data as they accumulate are logged below.

## 28 May 2021

1.  Adelanto ICE Processing Center - East and West have identical data for 2020, but the numbers are different for 2019 with East being much lower than west. Craig checked the inspections and the numbers are different for East and West in 2019 while they are in fact the same for 2020. Note that 2020 is a remote inspection. However, it is significant that the two are comparable in one instance and not comparable in another case.

2.  Almance County Jail and Chase County Detention Center both seem to register blank for solitary. Craig suspects this is because there were not cases of solitary reported.

## 27 May 2021

One of the important early observations has to do with the naming of facilities. ICE is often inconsistent with facility naming and the names do often change over time. Both the changing of names and inconsistent naming conventions can cause confusion as well as error when tabulating results.

1.  The graphs for "**Adelanto ICE Processing Center - East**" and "**Adelanto ICE Processing Center - West**" are identical. This is consistent with information Craig recalls seeing in one of the inspections, that the numbers for the facilities are "merged" or combined.

    -   For facet graphing consider filtering. For analysis purposes may need to treat the two facilities as "merged"

2.  "**Adelanto ICE Processing Center West**" should be combined with "**Adelanto ICE Processing Center - West**". It appears that ICE is not consistently naming the facilities, in one case the name lacks a dash character which causes them to be graphed separately.

    -   The dash was added to Adelanto West.

3.  It would be good to check if there really two facilities in Almance County. There are entries listed for "**Almance County Detention Center**" and "**Almance County Jail**".

    -   Need to verify that these are in fact distinct facilities.

4.  "**Aurora ICE Processing Center II - Annex**" and "**Aurora II Annex**" should probably be combined. Need to check the inspections to verify.

    -   "**Aurora II Annex (CO) - Jan. 29, 2021"** was changed to "**Aurora ICE Processing Center II - Annex (CO) - Jan. 29, 2021**"

# References

::: {#refs}
:::

# Appendix: Code used for this report

```{r ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE, class.source = 'fold-show'}

```

```{r package-references, echo=FALSE}
knitr::write_bib(file = 'packages.bib')
```
